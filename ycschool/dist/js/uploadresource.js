!function(e){var t={};function a(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=46)}({132:function(e,t){},46:function(e,t,a){"use strict";function s(e){return/\S+/.test(e)}a(132),$(window.parent.document).find("#jTeacherIframe").css("height",$(".uploadCourse").height()+280+"px"),new Vue({el:"#uploadResource",data:{gradeArr:[],termArr:[],subjectArr:[],outlineArr:[],gradeId:"",termId:"",subjectId:"",syllabusId:"",resourceId:0,syllabusName:"",resourcename:"",iconPath:"",filePath:"",fileName:"",desc:"",resourceType:"2",nodata:!1},filters:{addRootFile:function(e){return SERVERROOTFILE+e}},mounted:function(){var e=this;this.$nextTick(function(){e.initOutLine(),e.bindOutlineClick()})},methods:{init:function(){var e=this;"update"==$(this).getUrlParam("tag")&&e.$http.post(SERVERROOTDATA+"api/teacher/site/courseware.ashx?action=showResourceById",{id:$(this).getUrlParam("resourceId")},{emulateJSON:!0}).then(function(t){200==t.body.code&&t.body.rows.length>0&&($(".addImage img").attr("src",SERVERROOTFILE+t.body.rows[0].iconPath),e.resourceType=t.body.rows[0].resourceType,e.resourceId=t.body.rows[0].resourceId,e.gradeId=t.body.rows[0].gradeId,e.iconPath=t.body.rows[0].iconPath,e.resourcename=t.body.rows[0].title,e.subjectId=t.body.rows[0].subjectId,e.syllabusId=t.body.rows[0].syllabusId,e.syllabusName=t.body.rows[0].syllabusName,e.termId=t.body.rows[0].termId,e.filePath=t.body.rows[0].downloadPath,e.desc=t.body.rows[0].desc)}).then(function(){e.getOutline(e.termId,e.gradeId,e.subjectId)})},initOutLine:function(){var e=this;Promise.all([new Promise(function(t,a){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=gradeList",{},{emulateJSON:!0}).then(function(a){200==a.body.code&&(e.gradeArr=a.body.rows,a.body.rows.length>0&&"update"!=$(this).getUrlParam("tag")&&(e.gradeId=a.body.rows[0].gradeId)),t()}).then(function(){$("#grade").on("change",function(){e.gradeId=$(this).val(),e.getOutline(e.termId,e.gradeId,e.subjectId)})})}),new Promise(function(t,a){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=subjectList",{},{emulateJSON:!0}).then(function(a){200==a.body.code&&(e.subjectArr=a.body.rows,a.body.rows.length>0&&"update"!=$(this).getUrlParam("tag")&&(e.subjectId=a.body.rows[0].subjectId)),t()}).then(function(){$("#subject").on("change",function(){e.subjectId=$(this).val(),e.getOutline(e.termId,e.gradeId,e.subjectId)})})}),new Promise(function(t,a){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=getTerm",{},{emulateJSON:!0}).then(function(a){200==a.body.code&&(e.termArr=a.body.rows,a.body.rows.length>0&&"update"!=$(this).getUrlParam("tag")&&(e.termId=a.body.rows[0].id)),t()}).then(function(){$("#term").on("change",function(){e.termId=$(this).val(),e.getOutline(e.termId,e.gradeId,e.subjectId)})})})]).then(function(){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=getNodes",{gradeId:e.gradeId,subjectId:e.subjectId,termId:e.termId},{emulateJSON:!0}).then(function(t){200==t.body.code&&(e.outlineArr=t.body.rows,t.body.rows.length<1?e.nodata=!0:e.nodata=!1)}).then(function(){e.init()})})},getOutline:function(e,t,a){var s=this;s.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=getNodes",{gradeId:t,subjectId:a,termId:e},{emulateJSON:!0}).then(function(e){200==e.body.code&&(s.outlineArr=e.body.rows,e.body.rows.length<1?s.nodata=!0:s.nodata=!1)})},bindOutlineClick:function(){var e=this;$(".catalog").on("click",".first>h4",function(){$(this).next("ul").children().length<1?(e.syllabusName=$(this).html(),e.syllabusId=$(this).data("id")):$(this).prev("i").hasClass("uk-icon-caret-down")?($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-right"),$(this).next("ul").slideUp()):($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-down"),$(this).next("ul").slideDown())}),$(".catalog").on("click",".second>li>h4",function(){$(this).next("ul").children().length<1?(e.syllabusName=$(this).html(),e.syllabusId=$(this).data("id")):$(this).prev("i").hasClass("uk-icon-caret-down")?($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-right"),$(this).next("ul").slideUp()):($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-down"),$(this).next("ul").slideDown())}),$(".catalog").on("click",".three h4",function(){e.syllabusName=$(this).html(),e.syllabusId=$(this).data("id")})},addCover:function(e){var t=this;if($(e.target).val().match(/.jpg|.gif|.png|.bmp/i)){var a=new FormData($("#addImg")[0]);$.ajax({url:SERVERROOTDATA+"ashx/upload/UploadFile.ashx?action=formDataUploadNew",type:"POST",data:a,processData:!1,contentType:!1,success:function(a){var s=JSON.parse(a);if(200==s.code){var r=$(e.target).prev();upload(e.target,r),t.iconPath=s.iconPath}else layer.msg("上传失败")}})}else layer.msg("对不起，系统仅支持标准格式的照片，请您调整格式后重新上传，谢谢 !")},addDocument:function(e){var t=this;if($(e.target).val().match(/.pdf|.doc|.xls|.ppt/i)){var a=new FormData($("#addFile")[0]),s=$(window).storager({key:"ycToken"}).readStorage();a.append("ycToken",s),$.ajax({url:SERVERROOTDATA+"api/teacher/site/courseware.ashx?action=formDataUpload",type:"POST",data:a,processData:!1,contentType:!1,success:function(e){var a=JSON.parse(e);200==a.code?(t.filePath=a.filePath,t.fileName=a.fileName):layer.msg("上传失败")}})}else layer.msg("对不起，系统仅支持标准格式的文件，请您调整格式后重新上传，谢谢 !")},saveFirstStep:function(){if(s(this.resourcename))if(s(this.filePath))if(s(this.iconPath))if(s(this.desc)){var e=$(this).getUrlParam("tag");""!=e&&void 0!=e&&"undefined"!=e||(e="add");var t=layer.load(1,{shade:[.1,"#fff"]});this.$http.post(SERVERROOTDATA+"api/teacher/site/courseware.ashx?action=saveResource",{fileName:this.fileName,resourceType:this.resourceType,desc:this.desc,downloadPath:this.filePath,gradeId:this.gradeId,iconPath:this.iconPath,resourceId:this.resourceId,shareFlag:0,subjectId:this.subjectId,syllabusId:this.syllabusId,tag:e,termId:this.termId,title:this.resourcename},{emulateJSON:!0}).then(function(e){200==e.body.code?(layer.msg("上传成功"),setTimeout(function(){window.location.href="teachercenterresource.html"},1e3)):(layer.close(t),layer.msg("保存失败"))})}else layer.msg("请输入描述");else layer.msg("封面不能为空");else layer.msg("请上传文件");else layer.msg("资源名称不能为空")}}})}});