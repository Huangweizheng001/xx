!function(e){var t={};function o(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=47)}({132:function(e,t){},47:function(e,t,o){"use strict";function s(e){return/\S+/.test(e)}o(132),new Vue({el:"#uploadCourse",data:{isShow:!0,gradeArr:[],termArr:[],subjectArr:[],outlineArr:[],gradeId:"",termId:"",subjectId:"",syllabusId:"",syllabusName:"",coursename:"",iconPath:"",nodata:!1},filters:{addRootFile:function(e){return SERVERROOTFILE+e}},mounted:function(){var e=this;this.$nextTick(function(){e.initOutLine(),e.bindOutlineClick()})},methods:{init:function(){var e=this;"update"==$(this).getUrlParam("tag")&&e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=showCourseById",{id:$(this).getUrlParam("courseId")},{emulateJSON:!0}).then(function(t){200==t.body.code&&t.body.rows.length>0&&($("#code").val(t.body.rows[0].code),$("#courseTypeId").val(t.body.rows[0].courseTypeId),e.gradeId=t.body.rows[0].gradeId,$(".addImage img").attr("src",SERVERROOTFILE+t.body.rows[0].iconPath),e.iconPath=t.body.rows[0].iconPath,e.coursename=t.body.rows[0].name,e.subjectId=t.body.rows[0].subjectId,e.syllabusId=t.body.rows[0].syllabusId,e.syllabusName=t.body.rows[0].syllabusName,e.termId=t.body.rows[0].term,$("#courseVideoId").val(t.body.rows[0].courseVideoId),$("#courseId").val(t.body.rows[0].courseId))}).then(function(){e.getOutline(e.termId,e.gradeId,e.subjectId)})},initOutLine:function(){var e=this;Promise.all([new Promise(function(t,o){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=gradeList",{},{emulateJSON:!0}).then(function(o){200==o.body.code&&(e.gradeArr=o.body.rows,o.body.rows.length>0&&"update"!=$(this).getUrlParam("tag")&&(e.gradeId=o.body.rows[0].gradeId)),t()}).then(function(){$("#grade").on("change",function(){e.gradeId=$(this).val(),e.getOutline(e.termId,e.gradeId,e.subjectId)})})}),new Promise(function(t,o){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=subjectList",{},{emulateJSON:!0}).then(function(o){200==o.body.code&&(e.subjectArr=o.body.rows,o.body.rows.length>0&&"update"!=$(this).getUrlParam("tag")&&(e.subjectId=o.body.rows[0].subjectId)),t()}).then(function(){$("#subject").on("change",function(){e.subjectId=$(this).val(),e.getOutline(e.termId,e.gradeId,e.subjectId)})})}),new Promise(function(t,o){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=getTerm",{},{emulateJSON:!0}).then(function(o){200==o.body.code&&(e.termArr=o.body.rows,o.body.rows.length>0&&"update"!=$(this).getUrlParam("tag")&&(e.termId=o.body.rows[0].id)),t()}).then(function(){$("#term").on("change",function(){e.termId=$(this).val(),e.getOutline(e.termId,e.gradeId,e.subjectId)})})})]).then(function(){e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=getNodes",{gradeId:e.gradeId,subjectId:e.subjectId,termId:e.termId},{emulateJSON:!0}).then(function(t){200==t.body.code&&(e.outlineArr=t.body.rows,t.body.rows.length<1?e.nodata=!0:e.nodata=!1)}).then(function(){e.init()})})},getOutline:function(e,t,o){var s=this;s.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=getNodes",{gradeId:t,subjectId:o,termId:e},{emulateJSON:!0}).then(function(e){200==e.body.code&&(s.outlineArr=e.body.rows,e.body.rows.length<1?s.nodata=!0:s.nodata=!1)})},bindOutlineClick:function(){var e=this;$(".catalog").on("click",".first>h4",function(){$(this).next("ul").children().length<1?(e.syllabusName=$(this).html(),e.syllabusId=$(this).data("id")):$(this).prev("i").hasClass("uk-icon-caret-down")?($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-right"),$(this).next("ul").slideUp()):($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-down"),$(this).next("ul").slideDown())}),$(".catalog").on("click",".second>li>h4",function(){$(this).next("ul").children().length<1?(e.syllabusName=$(this).html(),e.syllabusId=$(this).data("id")):$(this).prev("i").hasClass("uk-icon-caret-down")?($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-right"),$(this).next("ul").slideUp()):($(this).prev("i").removeClass(),$(this).prev("i").addClass("uk-icon-caret-down"),$(this).next("ul").slideDown())}),$(".catalog").on("click",".three h4",function(){e.syllabusName=$(this).html(),e.syllabusId=$(this).data("id")})},addCover:function(e){var t=this;if($(e.target).val().match(/.jpg|.gif|.png|.bmp/i)){var o=new FormData($("#addImg")[0]);$.ajax({url:SERVERROOTDATA+"ashx/upload/UploadFile.ashx?action=formDataUploadNew",type:"POST",data:o,processData:!1,contentType:!1,success:function(o){var s=JSON.parse(o);if(200==s.code){var a=$(e.target).prev();upload(e.target,a),t.iconPath=s.iconPath}else layer.msg("上传失败")}})}else layer.msg("对不起，系统仅支持标准格式的照片，请您调整格式后重新上传，谢谢 !")},saveFirstStep:function(){var e=this;if(s(e.coursename))if(s(e.iconPath))if(s(e.syllabusId)){var t=$(this).getUrlParam("tag");""!=t&&void 0!=t&&"undefined"!=t||(t="add"),e.$http.post(SERVERROOTDATA+"api/teacher/site/course.ashx?action=saveCourse",{courseId:$(this).getUrlParam("courseId"),iconPath:e.iconPath,gradeId:e.gradeId,subjectId:e.subjectId,termId:e.termId,syllabusId:e.syllabusId,name:e.coursename,tag:t},{emulateJSON:!0}).then(function(t){200==t.body.code?(e.isShow=!1,$("#coverurl").val(e.iconPath),$(".secondStep").show(300),"add"==$(this).getUrlParam("tag")&&$("#courseId").val(t.body.rows[0].courseId)):(layer.msg("保存失败"),e.isShow=!0)})}else layer.msg("请选择目录");else layer.msg("封面不能为空");else layer.msg("课程名称不能为空")}}})}});