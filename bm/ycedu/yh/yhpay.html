<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<meta name="format-detection" content="telephone=yes">
		<meta name="Keywords" content="金融在线教育,金融培训,股票培训,股票知识,股票入门,股票学习,股票怎么玩,股票投资,汇市投资,大宗投资,贵金属投资,证券从业考试,投资理财,金融课程">
		<meta name="description" content="播米在线教育，国内在线金融教育领导者。播米在线立足互联网金融教育领域，以普及金融知识，提供金融教育为己任，致力于为学员提供专业、系统的教学服务。不限地域时间，在家就能上课。首节课0元试听！免费咨询热线：400-6430-618。" />
		<title>悦华会员支付</title>
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" href="/favicon.ico" type="image/x-icon">
		<link rel="stylesheet" href="../css/base.css" />
		<link rel="stylesheet" href="../css/ycstyle.css" />
		<link rel="stylesheet" href="../css/yhzt.css" />
		<style>
			.payLogin {
				left: 0 !important;
			}
		</style>
	</head>

	<body style="padding-top: 0;">
		<section class="bmyhPaySelectBox">
			<h4>悦华沙龙会员</h4>
			<div class="bmyhPayPrice">
				支付总额<span>￥<i>88.00</i></span>
			</div>

			<div class="bmyhPaySelectInner">
				<p class="bmyhPayType">支付方式</p>
				<div class="payment" dataId="0">
					<svg width="1em" height="1em" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="payment__icon">
						<path d="M1024 699.733V196.267C1024 89.6 934.4 0 827.733 0H196.267C89.6 0 0 89.6 0 196.267v631.466C0 934.4 89.6 1024 196.267 1024h631.466c98.134 0 179.2-68.267 192-162.133-51.2-21.334-277.333-119.467-396.8-174.934-89.6 106.667-183.466 174.934-324.266 174.934S64 776.533 72.533 669.867C81.067 601.6 128 486.4 337.067 503.467 448 512 499.2 533.333 588.8 563.2c21.333-42.667 42.667-89.6 55.467-140.8h-396.8V384h196.266v-72.533H204.8V268.8h238.933V166.4s4.267-17.067 21.334-17.067H563.2V268.8h256v42.667h-256V384h209.067c-17.067 76.8-46.934 149.333-85.334 213.333C746.667 614.4 1024 699.733 1024 699.733zm-742.4 89.6c-149.333 0-174.933-93.866-166.4-132.266 8.533-38.4 51.2-89.6 132.267-89.6 93.866 0 179.2 25.6 285.866 72.533-68.266 93.867-157.866 149.333-251.733 149.333z" fill="#1DABEB"></path>
					</svg> <span class="payment__text">支付宝</span>
					<div class="payment__radio active">
						<svg width="1em" height="1em" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="#39434E" class="check icon">
							<path d="M979.968 163.328L370.688 770.56 46.592 443.392 0 489.984 254.976 744.96l115.712 115.712L486.4 744.96l537.6-537.6z"></path>
						</svg>
					</div>
				</div>
				<div class="payment" dataId="1">
					<svg width="1em" height="1em" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="payment__icon">
						<path d="M446.63 585.864c-31.639 23.04-50.101 16.203-62.6-4.202l-55.642-136.117c-6.807-21.97 1.536-29.455 25.043-22.452l51.47 46.306c22.258 20.42 44.515 17.588 66.771 4.216l322.832-153.329C731.633 245.022 628.36 195.765 512 195.765c-190.765 0-346.353 132.382-346.353 294.686 0 93.982 52.179 177.92 133.135 231.936a83.727 83.727 0 0 1 2.726 30.946l-14.908 52.63c-6.958 23.311-.497 28.326 19.38 15.044l67.087-42.104a138.48 138.48 0 0 1 29.621-8.87 399.345 399.345 0 0 0 109.327 15.104c190.765 0 346.353-132.382 346.353-294.686 0-47.676-13.432-92.747-37.225-132.668L446.63 585.863z" fill="none"></path>
						<path d="M783.059 0H240.94C107.866 0 0 107.866 0 240.941V783.06C0 916.134 107.866 1024 240.941 1024H783.06C916.134 1024 1024 916.134 1024 783.059V240.94C1024 107.866 916.134 0 783.059 0zM512 785.122c-38.174 0-74.933-5.316-109.327-15.104a138.12 138.12 0 0 0-29.62 8.87l-67.088 42.104c-19.877 13.297-26.338 8.282-19.38-15.044l14.908-52.63a84.073 84.073 0 0 0-2.726-30.946c-80.941-54.001-133.12-137.954-133.12-231.921 0-162.304 155.588-294.686 346.353-294.686 116.36 0 219.633 49.257 282.488 124.506L471.658 473.6c-22.258 13.387-44.514 16.203-66.771-4.216l-51.471-46.306c-23.507-7.003-31.85.482-25.043 22.452l55.642 136.117c12.484 20.42 30.961 27.257 62.6 4.201l374.497-228.08c23.793 39.905 37.226 84.992 37.226 132.668.015 162.319-155.573 294.686-346.338 294.686z" fill="#59B64C"></path>
					</svg> <span class="payment__text">微信支付</span>
					<div class="payment__radio">
						<svg width="1em" height="1em" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" fill="#39434E" class="check icon">
							<path d="M979.968 163.328L370.688 770.56 46.592 443.392 0 489.984 254.976 744.96l115.712 115.712L486.4 744.96l537.6-537.6z"></path>
						</svg>
					</div>
				</div>
			</div>
			<div class="bmyhPayBtnBox">
				<a id="bmyhPayBtn" href="#this">前往支付</a>
			</div>
		</section>

		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/vue.min.js"></script>
		<script type="text/javascript" src="../js/vue-resource.min.js"></script>
		<script type="text/javascript" src="//g.alicdn.com/de/prismplayer/1.7.6/prism-min.js"></script>
		<script type="text/javascript" src="../js/layer,wow,scroll.js"></script>
		<script type="text/javascript" src="../js/ycedu.js"></script>
	</body>

	<script>
		$(function() {
			var payType = 0;
			var payPrice = 88.00;

			if($mid == null || $mid == undefined || $mid == "undefined" || $mid == "") {
				layer.open({
					type: 2,
					title: false,
					closeBtn: 0, //不显示关闭按钮
					shade: [0],
					shadeClose: true,
					skin: 'payLogin',
					//maxmin: true, //开启最大化最小化按钮
					area: ['100%', '100%'],
					content: '../../login.html?pageType=live'
				});
				
				$(".bmyhPaySelectBox").css("display","none")
				
				return false;
			} else {
				if($(this).getUrlParam("from") == "yhlive"){
					parent.fromPayOpt();
				}
				$.ajax({
					type: "post",
					url: ROUTE + "Member.ashx?action=getSowingCoinByMemberId",
					dataType: 'json',
					data: {
						"memberId": $mid
					},
					timeout: 600,
					success: function(res) {
						if(res[0].isSaLong == 1 || res[0].isSaLong =="1"){
							
							layer.msg("您已报名了该课程！");
							
							setTimeout(function(){
								parent.reloadWin();
							},1500)
						}
					},
					error: function(err) {
						console.log("request error");
					}
				});
			}

			//change pay type
			$(".payment").on("click", function() {
				if($(this).find(".payment__radio").hasClass("active")) {
					return false;
				} else {
					$(".payment__radio.active").removeClass("active");
					$(this).find(".payment__radio").addClass("active");
					payType = $(this).attr("dataId");
				}
			});

			var date = new Date();
			var month = date.getMonth() + 1;
			var strDate = date.getDate();
			var seconds = date.getSeconds();
			var randnum = "";
			for(var i = 0; i < 5; i++) {
				randnum += Math.floor(Math.random() * 10);
			}

			if(month >= 1 && month <= 9) {
				month = "0" + month;
			}
			if(strDate >= 0 && strDate <= 9) {
				strDate = "0" + strDate;
			}
			if(seconds >= 0 && seconds <= 9) {
				seconds = "0" + seconds;
			}

			var currentdate = String(date.getFullYear()) + String(month) + String(strDate) + String(date.getHours()) + String(date.getMinutes()) + String(seconds) + String(randnum);

			$("#bmyhPayBtn").on("click", function() {
				if(payType == 0 || payType == "0") {
					var newWindow = window.open('about:blank');
				}
				$.ajax({
					type: "post",
					url: ROUTE + "MemberGrade.ashx?action=purchaseMemberGrade",
					data: {
						"memberId": $mid,
						"purchaseAmount": payPrice,
						"payTypeId": payType, //支付方式：0-支付宝，1-微信，2-播米币
						"purchaseList": currentdate, //订单号,
						"memberGradeId": 17
					},
					success: function(res) {
						if(payType == 0) {
							newWindow.location.href = "../turnpayyh.html?rechargeAmount=" + payPrice + '&rechargeList=' + currentdate + '&memberId=' + $mid + '&memberGradeId=17';
							setTimeout(function() {
								layer.confirm("是否支付完成", {
									btn: ['重新选择支付方式', '支付完成'],
								}, function() {
									layer.closeAll('dialog')
								}, function() { //二次校验
									$.ajax({
										type: "POST",
										url: ROUTE + "MemberRecharge.ashx?action=checkPaySuccess",
										dataType: "json",
										data: {
											"memberId": $mid,
											"rechargeList": currentdate,
											"memberGradeId": 17
										},
										success: function(res) {
											if(res == '812') {
												layer.closeAll();
												layer.msg('支付成功');
											}
											if(res == '814') {
												layer.msg('支付失败，请重新支付');

											} else {
												return false;
											}
										}
									});
								});
							}, 3000);
						} else if(payType == 1 || payType == '1') {
							setTimeout(function() {
								var json = eval('(' + res + ')')
								layer.open({
									type: 1,
									title: '微信支付',
									area: ['420px', '420px'], //宽高
									content: "<div class='dycweixin-img' style='text-align:center;width:200px;height:200px;line-height:200px;margin:50px auto 0'><img src=" + ROUTEFILE + json.iconPath + " /></div><p style='text-align:center'>应付金额：<span style='color: #df5e3f;font-size: 20px;'>￥" + payPrice + "</span></p>",
									success: function() {

										var xunhuan = setInterval(function() {
											$.ajax({
												type: "POST",
												url: ROUTE + "MemberGrade.ashx?action=checkPaySuccess",
												dataType: "json",
												data: {
													"memberId": $mid,
													"purchaseList": currentdate
												},
												success: function(res) {
													if(res == '812') {
														clearInterval(xunhuan);
														layer.closeAll();
														layer.msg('支付成功');
													}
													if(res == '814') {
														setTimeout(function() {
															clearInterval(xunhuan);
														}, 60000);
														console.log("未完成");
													} else {
														return false;
													}
												}
											});
										}, 3000)
									},
									cancel: function() {
										//右上角关闭回调
										// clearInterval(xunhuan);
									}
								});
							}, 500);
						}
					},
					error: function(err) {
						console.log(err);
					}
				});
			})

		})
	</script>

</html>