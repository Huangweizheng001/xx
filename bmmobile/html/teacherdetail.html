<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<!--<meta name="format-detection" content="telephone=
			yes">
		<meta name="full-screen" content="yes">
		<meta name="x5-fullscreen" content="true">-->
		<meta name="keywords" content="播米在线">
		<meta name="description" content="播米在线">
		<link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-57x57-precomposed.png" />
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png" />
		<!--<link rel="stylesheet" href="../css/bmmobile.css" />-->
		<link rel="stylesheet" href="../css/bm.css">
		<link rel="stylesheet" href="../css/bmmobile_cyq.css">
		<link rel="stylesheet" href="../css/dropload.css">
		<link rel="stylesheet" href="../css/discuss.css">
		<title>嘉宾主页</title>

		<style>
			body {
				background: #ebebeb;
				padding-top: 8rem;
			}
			
			.teacherdetail-head {
				height: 176px;
				width: 100%;
				background: url(../images/teacher/teacher-bg.png) no-repeat;
				background-size: cover;
				box-sizing: border-box;
				padding: 1.5rem 3rem;
			}
			
			.teacherdetail-head .teacherdetail-head-img {
				float: left;
				/*width: 20%;*/
				width: 150px;
				height: 140px;
				overflow: hidden;
				/*width: 6rem;*/
				box-sizing: border-box;
				border-radius: 100%;
			}
			
			.teacherdetail-head .teacherdetail-head-box {
				float: left;
				box-sizing: border-box;
				/*width: 75%;*/
				padding-left: 20px;
				color: #fff;
				font-size: 1.5rem;
				line-height: 2;
			}
			
			.teacherdetail-head .teacherdetail-head-box h3 {
				font-size: 1.8rem;
				font-weight: normal;
			}
			
			.teacherdetail-head img {
				display: block;
			/*	border-radius: 100%;*/
			}
			
			.teacherdetail-box {
				margin: 0.8rem 0;
			}
			
			.swiper-wrapper {
				margin-top: 0.8rem;
			}
			
			.swiper-container-horizontal>.swiper-pagination-bullets,
			.swiper-pagination-custom,
			.swiper-pagination-fraction {
				line-height: 2.28;
				background: #fff;
				/*bottom: 10px;*/
				left: 0;
				width: 100%;
				overflow: hidden;
				padding-bottom: 3rem;
				border-bottom: 1px solid #fff;
			}
			
			.swiper-pagination-bullet {
				position: relative;
				box-sizing: border-box;
				width: 30%;
				float: left;
				display: inline-block;
				text-align: center;
				color: #3d3d3d;
				font-size: 1.7rem;
				background: none;
			}
			
			.swiper-pagination-bullet-active {
				opacity: 1;
				color: #1473e6;
			}
			
			.swiper-pagination-bullet-active:after {
				content: "";
				position: absolute;
				width: 80%;
				height: 1px;
				bottom: -3.01rem;
				left: 0;
				right: 0;
				width: 80%;
				margin: auto;
				background-color: #1473e6;
			}
			/*课程列表*/
			
			.teacherdetailList {
				padding: 0 1.54rem;
				background: #fff;
			}
			
			.teacherdetailList li {
				width: 50%;
				float: left;
				padding: 1.5rem 0.85rem 0;
				box-sizing: border-box;
			}
			
			.teacherdetailList li a {
				display: block;
			}
			
			.teacherdetailList li .img {
				height: 200px;
				overflow: hidden;
				border-radius: .6rem;
			}
			
			.teacherdetailList li img {
				width: 100%;
				border-radius: .6rem;
			}
			
			.teacherdetailList li p {
				color: #d0d0d0;
				font-size: 1.355rem;
				line-height: 1.8;
			}
			
			.teacherdetailList .title {
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				color: #282828;
				font-size: 1.456rem;
			}
			
			@media screen and (max-width: 760px) {
				.teacherdetailList li .img,
				.teacherdetailList li img {
					height: 110px;
				}
				.teacherdetail-head {
					height: 150px;
				}
				.teacherdetail-head .teacherdetail-head-img {
					width: 95px;
					height: 95px;
				}
			}
			
			@media screen and (max-width: 476px) {
				.teacherdetailList li .img,
				.teacherdetailList li img {
					height: 100px;
				}
				.teacherdetail-head {
					height: 120px;
				}
				.teacherdetail-head .teacherdetail-head-img {
					width: 80px;
					height: 80px;
				}
			}
			
			.teacherdetai-con {
				padding: 1rem 1.5rem;
				background: #fff;
				margin-bottom: 0.8rem;
				word-break: break-all;
				color: #595959;
			}
			
			.teacherdetai-con p {
				font-size: 1.5rem !important;
				line-height: 1.5 !important;
			}
			
			.teacherdetai-con span {
				display: inline
			}
			
			.teacherdetai-con h1 {
				color: #000;
				font-weight: normal;
				font-size: 1.55rem;
				line-height: 1;
				margin-bottom: 10px;
				padding-bottom: 10px;
				border-bottom: 1px solid #ccc;
			}
		</style>
	</head>

	<body>
		<div class="bmmain-container flex-wrap flex-vertical">
			<header id="header" class="blue">
				<span onclick="goBack()" style="display: none">返回</span>
				<p>嘉宾主页</p>
			</header>
			<section class="flex-con">
				<div class="teacherdetail-head clearfix">
					<div class="teacherdetail-head-img" id="jteacherAvar">
						<!--<img src="../images/teacher/teacher-avar.png" />-->
					</div>
					<div class="teacherdetail-head-box" id="jteacherName">
						<!--<h3>周璇</h3>
						<p>高级研究院</p>-->
					</div>

				</div>
			</section>

			<section class="teacherdetail-box flex-con">
				<div class="swiper-container teacherdetail-container">
					<ul class="teacherdetail-swiper-pagination flex-con" id="courseNav"></ul>
					<div class="swiper-wrapper swiper-no-swiping">
						<div class="swiper-slide">
							<!--主页-->
							<section class="flex-con overAuto">
								<div id="discussindex">
									<section id="discuss"></section>
								</div>
							</section>

						</div>
						<div class="swiper-slide">
							<section class="flex-con overAuto">
								<div id="content">
									<ul id="teacherdetailList" class="teacherdetailList clearfix"></ul>
								</div>
							</section>
						</div>
						<div class="swiper-slide">
							<div class="teacherdetai-con">
								<h1>个人经历</h1>
								<div id="jteacherRecord"></div>
							</div>
							<div class="teacherdetai-con">
								<h1>风格理念</h1>
								<div id="jteacherStyle"></div>
							</div>
							<div class="teacherdetai-con">
								<h1>战绩之王</h1>
								<div id="jteacherKing"></div>
							</div>
						</div>
					</div>
				</div>
			</section>

		</div>

		<script type="text/javascript" src="../js/zepto.min.js"></script>
		<script type="text/javascript" src="../js/swiper.jquery.min.js"></script>
		<script type="text/javascript" src="../js/bmmain.js"></script>
		<script type="text/javascript" src="../js/layer.js"></script>
		<script type="text/javascript" src="../js/zepto.picLazyLoad.min.js"></script>
		<script type="text/javascript" src="../js/dropload.min.js"></script>

		<script>
			$(function() {
				
				var tId = $.getUrlParam("teacherId");
				var live = $.getUrlParam("live");//0是悦华，1是叠报
				if( live == 1){
					$(document).ready(function(e) {

					var counter = 0;
					if (window.history && window.history.pushState) {
					$(window).on('popstate', function () {
					window.history.pushState('forward', null, '#');
					window.history.forward(1);
					window.location.href='dbliveroom.html?live=1';//跳转到叠报直播
					});
					}
					window.history.pushState('forward', null, '#'); //在IE中必须得有这两行
					window.history.forward(1);
					});
				}else if( live == 0){
					$(document).ready(function(e) {

					var counter = 0;
					if (window.history && window.history.pushState) {
					$(window).on('popstate', function () {
					window.history.pushState('forward', null, '#');
					window.history.forward(1);
					window.location.href='liveroom.html?live=1';//跳转悦华直播
					});
					}
					window.history.pushState('forward', null, '#'); //在IE中必须得有这两行
					window.history.forward(1);
					});
				}
				

				var itemIndex = 0,
					LoadEnd_tab = false,
					pageCount = 0;

				// 每页展示6个
				var num = 6;
				var nownum = 0; //当前数据在第几条

				getTeacherName(tId); //获取嘉宾名字

				// dropload，获取课程
				var dropload = $('#content').dropload({
					scrollArea: window,
					loadDownFn: function(me) {
						//获取类型
						setTimeout(function() {
							pageCount++;
							getCourseList(me, pageCount, tId, itemIndex); //默认首页
						}, 200);

					}
				});

				//teacher履历
				getTeacherDetail(tId);

				ckdetail(); //切换

				function getTeacherName(tId) { //获取嘉宾名字和等级
					var teacherAvar = $('#jteacherAvar'),
						teacherName = $('#jteacherName'),
						htmlAvar = "",
						htmlStr = "";

					$.ajax({
						type: "GET",
						url: SERVEROOTDATA + 'Teacher.ashx?action=getTeacherDetailById',
						dataType: "json",
						data: {
							"teacherId": tId
						},
						success: function(result) {
							if(result.length < 1) {
								return false;
							}
							obj = result[0];
							htmlAvar = "<img src=" + SERVEROOTFILE + obj.iconPath + " />";
							htmlStr = "<h3>" + obj.name + "</h3><p>" + obj.teacherTypeName + "</p>";
							teacherAvar.html(htmlAvar);
							teacherName.html(htmlStr);

						},
						error: function(err) {
							console.log(err);
						}
					});

				}

				//get course banner list
				function getCourseList(me, pageIndex, cId, itemIndex) {
					var courseBox = $('#teacherdetailList'),
						$htmlStr = "";

					$.ajax({
						type: "GET",
						url: SERVEROOTDATA + 'Course.ashx?action=getTeacherRelativeCourse',
						dataType: "json",
						data: {
							"teacherId": tId,
							"pageIndex": pageIndex,
							"pageSize": num
						},
						success: function(result) {

							if(result.rows.length < 1) {
								LoadEnd_tab = true;
								// 锁定
								me.lock();
								// 无数据
								me.noData();

								// 为了测试，延迟1秒加载
								setTimeout(function() {
									// 每次数据加载完，必须重置
									me.resetload();
								}, 1000);

								return false;
							}
							result.rows.forEach(function(value, index) {

								var imgSrc = value.mobileIconPath;
								if((imgSrc == "") || (imgSrc == undefined) || (imgSrc == "undefined")) {
									imgSrc = '../images/public/default.png';
								} else {
									imgSrc = SERVEROOTFILE + imgSrc;
								}
								$htmlStr += '<li><a href="coursedetail.html?courseId=' + value.courseId + '">' + '<div class="img">' + '<img class="lazyload" src="../images/public/default.png" data-original="' + imgSrc + '" /></div>' + '<p class="title">' + value.name + '</p>' + '<p class="price">￥' + value.preferentialPrice + '</p></a></li>';
								nownum = (pageIndex - 1) * num + index + 1;
								if((nownum) >= result.totalCount) {
									console.log('到底啦')
									// 数据加载完
									//LoadEnd = true;
									LoadEnd_tab = true;
									// 锁定
									me.lock();
									// 无数据
									me.noData();
									//break;
								}
							});
							// 为了测试，延迟1秒加载
							setTimeout(function() {
								courseBox.append($htmlStr);
								$("#content .lazyload").picLazyLoad({
									threshold: 10
								});
								window.kcxqSwiper.update();
								// 每次数据加载完，必须重置
								me.resetload();

							}, 1000);

						},
						error: function(err) {
							console.log('服务器出错了~');
							// 加载出错，也得重置
							me.resetload();
						}
					});
				}

				//get teacher detail
				function getTeacherDetail(tId) {
					var teacherRecord = $('#jteacherRecord'),
						teacherStyle = $('#jteacherStyle'),
						jteacherKing = $('#jteacherKing');

					$.ajax({
						type: "GET",
						url: SERVEROOTDATA + 'Teacher.ashx?action=getTeacherEncyclopedia',
						dataType: "json",
						data: {
							"teacherId": tId
						},
						success: function(result) {
							if(result.length < 1) {
								return false;
							}
							obj = result[0];
							teacherRecord.html(obj.experience);
							teacherStyle.html(obj.styleConcept);
							jteacherKing.html(obj.kingRecord);
							window.kcxqSwiper.update();

						},
						error: function(err) {
							console.log(err);
						}
					});
				}

				function ckdetail() {
					window.kcxqSwiper = new Swiper('.teacherdetail-container', {
						mousewheelControl: false,
						noSwiping: true,
						autoHeight: true,
						pagination: '.teacherdetail-swiper-pagination',
						paginationClickable: true,
						paginationBulletRender: function(tzksSwiper, index, className) {
							switch(index) {
								case 0:
									name = '嘉宾主页';
									break;
								case 1:
									name = '课程';
									break;
								case 2:
									name = '履历';
									break;
								default:
									name = '';
							}
							return '<li class="' + className + '" data-id=' + index + '>' + name + '</li>';
						}
					});

				}

				

			});
		</script>
		<script type="text/javascript" src="../js/discuss.js"></script>
	</body>

</html>